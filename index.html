<!DOCTYPE html>
<html>
<head>
    <title>AR Multi-Phone Cinema</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background: #000; }
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; z-index: 9999;
            background: rgba(255, 255, 255, 0.9); padding: 15px; box-sizing: border-box;
        }
        .btn { 
            padding: 12px 20px; border: none; border-radius: 5px; 
            font-weight: bold; cursor: pointer; margin: 5px 0;
        }
        .btn-share { background: #2ecc71; color: white; }
        .btn-size { background: #3498db; color: white; width: 45px; }
        input { padding: 10px; width: 150px; border: 1px solid #ccc; border-radius: 5px; }
        .id-badge { font-weight: bold; color: #e67e22; font-size: 1.2em; }
        #ar-instructions { position: fixed; bottom: 20px; width: 100%; text-align: center; color: white; pointer-events: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="my-id-display">Connecting to network...</div>
        <hr>
        <div>
            <strong>Phone A (Projector):</strong><br>
            <input type="text" id="target-id" placeholder="Paste Phone B ID here">
            <button class="btn btn-share" onclick="startBroadcasting()">Start Sharing Screen</button>
        </div>
        <hr>
        <div>
            <strong>Adjust Screen:</strong> 
            <button class="btn btn-size" onclick="adjustSize(0.5)">+</button>
            <button class="btn btn-size" onclick="adjustSize(-0.5)">-</button>
            <button class="btn btn-size" onclick="adjustDepth(-0.5)">Closer</button>
            <button class="btn btn-size" onclick="adjustDepth(0.5)">Away</button>
        </div>
        <button onclick="document.getElementById('ui-layer').style.display='none'" style="margin-top:10px;">Hide Menu</button>
    </div>

    <div id="ar-instructions">Point camera around room. Use 2nd phone to connect.</div>

    <a-scene embedded vr-mode-ui="enabled: true" arjs="sourceType: webcam; debugUIEnabled: false;">
        
        <a-assets>
            <video id="shared-video" autoplay playsinline crossorigin="anonymous"></video>
        </a-assets>

        <a-video 
            id="floating-screen"
            src="#shared-video" 
            width="4" 
            height="2.25" 
            position="0 1.6 -4" 
            rotation="0 0 0">
        </a-video>

        <a-entity camera look-controls wasd-controls position="0 1.6 0"></a-entity>

    </a-scene>

    <script>
        const peer = new Peer();
        const videoElement = document.getElementById('shared-video');
        const screenEl = document.getElementById('floating-screen');

        // 1. Get My ID
        peer.on('open', (id) => {
            document.getElementById('my-id-display').innerHTML = "Your ID: <span class='id-badge'>" + id + "</span>";
        });

        // 2. RECEIVER LOGIC (Phone B)
        peer.on('call', (call) => {
            call.answer(); // Answer the call
            call.on('stream', (remoteStream) => {
                videoElement.srcObject = remoteStream;
                videoElement.play().catch(e => console.log("Auto-play blocked, tap screen"));
            });
        });

        // 3. SENDER LOGIC (Phone A)
        async function startBroadcasting() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ 
                    video: { cursor: "always" },
                    audio: true 
                });
                const targetId = document.getElementById('target-id').value;
                if(!targetId) return alert("Please enter the ID of Phone B!");
                
                peer.call(targetId, stream);
            } catch (err) {
                alert("Error sharing screen: " + err);
            }
        }

        // 4. ADJUSTMENT TOOLS
        function adjustSize(delta) {
            let w = parseFloat(screenEl.getAttribute('width'));
            let h = parseFloat(screenEl.getAttribute('height'));
            screenEl.setAttribute('width', w + delta);
            screenEl.setAttribute('height', (w + delta) * 0.5625); // Keeps 16:9 ratio
        }

        function adjustDepth(delta) {
            let pos = screenEl.getAttribute('position');
            pos.z += delta;
            screenEl.setAttribute('position', pos);
        }
    </script>
</body>
</html>

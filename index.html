<!DOCTYPE html>
<html>
<head>
    <title>World-Locked AR Cinema</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        .ui-panel {
            position: absolute; top: 10px; left: 10px; z-index: 1000;
            background: rgba(0, 0, 0, 0.75); color: white;
            padding: 15px; border-radius: 12px; width: 280px;
        }
        button { 
            padding: 10px; margin: 4px; border: none; border-radius: 6px;
            cursor: pointer; font-weight: bold; background: #007bff; color: white;
        }
        .move-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
    </style>
</head>
<body>

    <div class="ui-panel" id="menu">
        <div id="my-id" style="color:#0f0">ID: Loading...</div>
        <input type="text" id="target-id" style="width:90%; padding:5px; margin:10px 0;" placeholder="Phone B ID">
        <button onclick="startSharing()" style="width:100%; background:#28a745">PHONE A: SHARE SCREEN</button>
        <hr>
        <div class="move-btns">
            <button onclick="moveScreen('z', 0.5)">Bring Closer</button>
            <button onclick="moveScreen('z', -0.5)">Push Away</button>
            <button onclick="moveScreen('y', 0.2)">Move Up</button>
            <button onclick="moveScreen('y', -0.2)">Move Down</button>
        </div>
        <button onclick="document.getElementById('menu').style.display='none'" style="width:100%; margin-top:10px; background:#555">HIDE MENU</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;">
        
        <a-assets>
            <video id="shared-video" autoplay playsinline crossorigin="anonymous"></video>
        </a-assets>

        <a-video id="floating-screen" src="#shared-video" 
                 width="4" height="2.25" 
                 position="0 1.6 -3"
                 rotation="0 0 0"
                 material="shader: flat; side: double">
        </a-video>

        <a-entity camera look-controls position="0 1.6 0"></a-entity>
        
    </a-scene>

    <script>
        const peer = new Peer();
        const videoElement = document.getElementById('shared-video');
        const screen = document.getElementById('floating-screen');

        peer.on('open', (id) => { document.getElementById('my-id').innerText = "Your ID: " + id; });

        peer.on('call', (call) => {
            call.answer();
            call.on('stream', (stream) => {
                videoElement.srcObject = stream;
                videoElement.play();
            });
        });

        async function startSharing() {
            const tid = document.getElementById('target-id').value;
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                peer.call(tid, stream);
            } catch (e) { alert("Enable 'Desktop Site' in Chrome!"); }
        }

        // Function to adjust position while in VR
        function moveScreen(axis, amount) {
            let pos = screen.getAttribute('position');
            pos[axis] += amount;
            screen.setAttribute('position', pos);
        }

        window.addEventListener('click', () => { videoElement.play(); });
    </script>
</body>
</html>

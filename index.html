<!DOCTYPE html>
<html>
<head>
    <title>Spatial AR Desktop</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        .glass-ui {
            position: absolute; top: 20px; left: 20px; z-index: 1000;
            background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);
            padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3);
            color: white; font-family: 'Segoe UI', sans-serif;
        }
        button {
            background: #fff; color: #000; border: none; padding: 10px 20px;
            border-radius: 30px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="glass-ui" id="gui">
        <div id="id-tag">ID: Loading...</div>
        <input type="text" id="partner-id" placeholder="Paste ID here" style="margin-top:10px; border-radius:5px; padding:5px;">
        <br>
        <button onclick="startCast()">Cast My Screen</button>
        <button onclick="this.parentElement.style.display='none'" style="background:none; color:white; border:1px solid white;">Hide Interface</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;" renderer="antialias: true; colorManagement: true;">
        
        <a-assets>
            <video id="stream-view" autoplay playsinline crossorigin="anonymous"></video>
        </a-assets>

        <a-video id="main-screen" src="#stream-view" 
                 width="4" height="2.25" 
                 position="0 1.6 -4" 
                 material="shader: flat; side: double; transparent: true; opacity: 0.95"
                 geometry="primitive: plane; skipCache: true">
            <a-entity geometry="primitive: plane; width: 4.1; height: 2.35" 
                      material="color: white; shader: flat; side: back" 
                      position="0 0 -0.01"></a-entity>
        </a-video>

        <a-entity camera look-controls position="0 1.6 0"></a-entity>
        
    </a-scene>

    <script>
        const peer = new Peer();
        const vid = document.getElementById('stream-view');

        peer.on('open', id => { document.getElementById('id-tag').innerText = "Your ID: " + id; });

        peer.on('call', call => {
            call.answer();
            call.on('stream', s => {
                vid.srcObject = s;
                vid.play();
                document.getElementById('gui').style.display = 'none'; // Auto-hide menu when connected
            });
        });

        async function startCast() {
            const pid = document.getElementById('partner-id').value;
            try {
                // If this fails on mobile, try using a Laptop as the 'Projector'
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                peer.call(pid, stream);
            } catch (e) {
                alert("Mobile security blocked screen sharing. Use a Laptop to 'Cast' to your phone!");
            }
        }

        window.addEventListener('click', () => { vid.play(); });
    </script>
</body>
</html>
